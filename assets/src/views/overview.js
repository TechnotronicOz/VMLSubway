// Generated by CoffeeScript 1.4.0
var OverviewView;

OverviewView = Backbone.View.extend({
  initialize: function() {
    return this.render();
  },
  events: {
    'click #connect-button': 'connect',
    'click #connect-more-options-button': 'more_options',
    'click #login-button': 'login_register',
    'click #register-button': 'login_register',
    'keypress': 'connectOnEnter',
    'click #connect-secure': 'toggle_ssl_options'
  },
  el: '.content',
  render: function(event) {
    var func;
    $(this.el).html(ich.overview());
    setTimeout((function() {
      return $('#overview').removeClass('closed');
    }), 500);
    if (event === void 0) {
      $('#overview').html(ich.overview_home());
    } else {
      func = ich['overview_' + event.currentTarget.id];
      $('#overview').html(func({
        'loggedIn': irc.loggedIn
      }));
    }
    $('.overview_button').bind('click', $.proxy(this.render, this));
    return this;
  },
  connectOnEnter: function(event) {
    if (event.keyCode !== 13) {
      return;
    }
    if ($('#connect-button').length) {
      this.connect(event);
    }
    if ($('#login-button').length) {
      event.action = 'Login';
      this.login_register(event);
    }
    if ($('#register-button').length) {
      event.action = 'Register';
      return this.login_register(event);
    }
  },
  connect: function(event) {
    var away, encoding, keepAlive, keepAlve, nick, password, port, realName, rejoin, secure, selfSigned, server;
    event.preventDefault();
    $('.error').removeClass('error');
    server = $('#connect-server').val();
    nick = $('#connect-nick').val();
    port = $('#connect-port').val();
    away = $('#connect-away').val();
    realName = $('#connect-realName').val();
    secure = $('#connect-secure').is(':checked');
    selfSigned = $('#connect-selfSigned').is(':checked');
    rejoin = $('#connect-rejoin').is(':checked');
    password = $('#connect-password').val();
    encoding = $('#connect-encoding').val();
    keepAlve = false;
    if (!server) {
      $('#connect-server').closest('.control-group').addClass('error');
    }
    if (!nick) {
      $('#connect-nick').closest('.control-group').addClass('error');
    }
    if (irc.loggedIn && $('#connect-keep-alive').length) {
      keepAlive = $('#connect-keep-alive').is(':checked');
    }
    if (nick && server) {
      $('form').append(ich.load_image());
      $('#connect-button').addClass('disabled');
      ({
        connectInfo: {
          nick: nick,
          server: server,
          port: port,
          secure: secure,
          selfSigned: selfSigned,
          rejoin: rejoin,
          away: away,
          realName: realName,
          password: password,
          encoding: encoding,
          keepAlive: keepAlive
        }
      });
      irc.me = new User(connectInfo);
      irc.me.on('change:nick', irc.appView.renderUserBox);
      return irc.socket.emit('connect', connectInfo);
    }
  },
  more_options: function() {
    return this.$el.find('.connect-more-options').toggleClass('hide');
  },
  login_register: function(event) {
    var action, password, username;
    action = event.target.innerHTML.toLowerCase() || event.action.toLowerCase();
    event.preventDefault();
    $('.error').removeClass('error');
    username = $('#' + action + '-username').val();
    password = $('#' + action + '-password').val();
    if (!username) {
      $('#' + action + '-username').closest('.clearfix').addClass('error');
      $('#' + action + '-username').addClass('error');
    }
    if (!password) {
      $('#' + action + '-password').closest('.clearfix').addClass('error');
      $('#login-password').addClass('error');
    }
    if (username && password) {
      $('form').append(ich.load_image());
      $('#' + action + '-button').addClass('disabled');
    }
    return irc.socket.emit(action, {
      username: username,
      password: password
    });
  },
  toggle_ssl_options: function(event) {
    var port;
    port = $('#connect-secure').is(':checked') ? 6697 : 6667;
    $('#connect-port').attr('placeholder', port);
    return $('#ssl-self-signed').toggle();
  }
});
